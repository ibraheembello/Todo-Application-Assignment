<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %> - Todo App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fas fa-tasks me-2"></i>Todo App
        </a>

        <div class="navbar-nav ms-auto">
          <span class="navbar-text me-3"> Welcome, <%= user.username %>! </span>
          <form action="/auth/logout" method="POST" class="d-inline">
            <button type="submit" class="btn btn-outline-light btn-sm">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </form>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    <% if (messages.error && messages.error.length > 0) { %>
    <div class="container mt-3">
      <% messages.error.forEach(function(message) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i><%= message %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      <% }); %>
    </div>
    <% } %> <% if (messages.success && messages.success.length > 0) { %>
    <div class="container mt-3">
      <% messages.success.forEach(function(message) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i><%= message %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      <% }); %>
    </div>
    <% } %>

    <div class="container mt-4">
      <!-- Header Section -->
      <div class="row mb-4">
        <div class="col-md-8">
          <h1 class="mb-0">
            <i class="fas fa-list-ul me-2 text-primary"></i>My Tasks
          </h1>
          <p class="text-muted mt-2">Manage your daily tasks efficiently</p>
        </div>
        <div class="col-md-4 text-end">
          <a href="/todos/create" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Add New Task
          </a>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card border-warning">
            <div class="card-body text-center">
              <h5 class="card-title text-warning">
                <i class="fas fa-clock me-2"></i>Pending Tasks
              </h5>
              <h2 class="text-warning"><%= pendingCount %></h2>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card border-success">
            <div class="card-body text-center">
              <h5 class="card-title text-success">
                <i class="fas fa-check-circle me-2"></i>Completed Tasks
              </h5>
              <h2 class="text-success"><%= completedCount %></h2>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter Tabs -->
      <div class="card">
        <div class="card-header">
          <ul class="nav nav-tabs card-header-tabs" role="tablist">
            <li class="nav-item">
              <a
                class="nav-link <%= filter === 'all' ? 'active' : '' %>"
                href="/todos?filter=all"
              >
                <i class="fas fa-list me-2"></i>All Tasks
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link <%= filter === 'pending' ? 'active' : '' %>"
                href="/todos?filter=pending"
              >
                <i class="fas fa-clock me-2"></i>Pending
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link <%= filter === 'completed' ? 'active' : '' %>"
                href="/todos?filter=completed"
              >
                <i class="fas fa-check-circle me-2"></i>Completed
              </a>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <% if (tasks.length === 0) { %>
          <div class="text-center py-5">
            <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No tasks found</h5>
            <p class="text-muted">
              <% if (filter === 'pending') { %> You don't have any pending
              tasks. <% } else if (filter === 'completed') { %> You haven't
              completed any tasks yet. <% } else { %> Start by creating your
              first task. <% } %>
            </p>
            <a href="/todos/create" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>Create Your First Task
            </a>
          </div>
          <% } else { %>
          <div class="row">
            <% tasks.forEach(function(task) { %>
            <div class="col-md-6 col-lg-4 mb-3">
              <div
                class="card h-100 task-card <%= task.status === 'completed' ? 'border-success' : 'border-warning' %>"
              >
                <div class="card-body">
                  <div
                    class="d-flex justify-content-between align-items-start mb-2"
                  >
                    <h6 class="card-title mb-0">
                      <% if (task.status === 'completed') { %>
                      <s><%= task.title %></s>
                      <% } else { %> <%= task.title %> <% } %>
                    </h6>
                    <span
                      class="badge <%= task.status === 'completed' ? 'bg-success' : 'bg-warning' %>"
                    >
                      <%= task.status %>
                    </span>
                  </div>

                  <% if (task.description) { %>
                  <p class="card-text text-muted small">
                    <%= task.description.length > 100 ?
                    task.description.substring(0, 100) + '...' :
                    task.description %>
                  </p>
                  <% } %>

                  <small class="text-muted">
                    <i class="fas fa-calendar-alt me-1"></i>
                    <%= task.formattedDate %>
                  </small>
                </div>
                <div class="card-footer bg-transparent">
                  <div class="btn-group btn-group-sm w-100" role="group">
                    <a
                      href="/todos/<%= task._id %>"
                      class="btn btn-outline-info"
                    >
                      <i class="fas fa-eye"></i>
                    </a>

                    <% if (task.status === 'pending') { %>
                    <form
                      action="/todos/<%= task._id %>/status?_method=PATCH"
                      method="POST"
                      class="d-inline"
                    >
                      <input type="hidden" name="status" value="completed" />
                      <button
                        type="submit"
                        class="btn btn-outline-success"
                        title="Mark as completed"
                      >
                        <i class="fas fa-check"></i>
                      </button>
                    </form>
                    <% } else { %>
                    <form
                      action="/todos/<%= task._id %>/status?_method=PATCH"
                      method="POST"
                      class="d-inline"
                    >
                      <input type="hidden" name="status" value="pending" />
                      <button
                        type="submit"
                        class="btn btn-outline-warning"
                        title="Mark as pending"
                      >
                        <i class="fas fa-undo"></i>
                      </button>
                    </form>
                    <% } %>

                    <form
                      action="/todos/<%= task._id %>/status?_method=PATCH"
                      method="POST"
                      class="d-inline"
                    >
                      <input type="hidden" name="status" value="deleted" />
                      <button
                        type="submit"
                        class="btn btn-outline-danger"
                        onclick="return confirm('Are you sure you want to delete this task?')"
                        title="Delete task"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <% }); %>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light text-center text-muted py-3 mt-5">
      <div class="container">
        <small
          >&copy; 2024 Todo App. Built with Node.js, Express & MongoDB.</small
        >
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      .task-card {
        transition: transform 0.2s;
      }
      .task-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
    </style>
  </body>
</html>
